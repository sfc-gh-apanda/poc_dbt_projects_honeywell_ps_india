version: 2

models:
  - name: dim_o2c_customer
    description: |
      **Customer Dimension**
      
      **Data Load Pattern:** TRUNCATE & LOAD (materialized='table')
      
      Full table replacement on every dbt run.
      
      **Audit Columns:**
      - dbt_run_id: dbt invocation ID
      - dbt_batch_id: Unique per model per run
      - dbt_loaded_at: Load timestamp
      - dbt_row_hash: Change detection hash
    
    access: public
    
    config:
      tags: ['dimension', 'truncate_load', 'pattern_example']
      contract:
        enforced: true
    
    columns:
      - name: customer_key
        description: "Surrogate key (customer_num_sk|source_system)"
        data_type: VARCHAR(16777216)
        tests:
          - unique
          - not_null
      
      - name: source_system
        description: "Source ERP system"
        data_type: VARCHAR(16777216)
        tests:
          - not_null
      
      - name: customer_id
        description: "Customer ID (natural key)"
        data_type: NUMBER(38,0)
        tests:
          - not_null
      
      - name: customer_name
        description: "Customer name"
        data_type: VARCHAR(16777216)
      
      - name: customer_type
        description: "Customer type (E=External, I=Internal)"
        data_type: VARCHAR(16777216)
      
      - name: customer_country
        description: "Customer country code"
        data_type: VARCHAR(16777216)
      
      - name: customer_country_name
        description: "Customer country full name"
        data_type: VARCHAR(16777216)
      
      - name: customer_classification
        description: "Customer classification"
        data_type: VARCHAR(16777216)
      
      - name: customer_account_group
        description: "Customer account group"
        data_type: VARCHAR(16777216)
      
      - name: duns_number
        description: "DUNS number"
        data_type: VARCHAR(16777216)
      
      - name: global_ultimate_duns
        description: "MDM Global Ultimate DUNS"
        data_type: VARCHAR(16777216)
      
      - name: global_ultimate_name
        description: "MDM Global Ultimate Name"
        data_type: VARCHAR(16777216)
      
      - name: full_name
        description: "MDM Full Name"
        data_type: VARCHAR(16777216)
      
      - name: is_internal
        description: "Internal customer flag"
        data_type: BOOLEAN
      
      - name: source_load_ts
        description: "Source system load timestamp"
        data_type: TIMESTAMP_NTZ
      
      - name: source_update_ts
        description: "Source system update timestamp"
        data_type: TIMESTAMP_NTZ
      
      - name: dbt_row_hash
        description: "Row hash for change detection"
        data_type: VARCHAR(16777216)
      
      - name: dbt_run_id
        description: "dbt invocation ID"
        data_type: VARCHAR(16777216)
        tests:
          - not_null
      
      - name: dbt_batch_id
        description: "Batch ID (unique per model per run)"
        data_type: VARCHAR(16777216)
        tests:
          - not_null
      
      - name: dbt_loaded_at
        description: "Load timestamp"
        data_type: TIMESTAMP_NTZ
        tests:
          - not_null
      
      - name: dbt_created_at
        description: "Record creation timestamp"
        data_type: TIMESTAMP_NTZ
        tests:
          - not_null
      
      - name: dbt_updated_at
        description: "Record update timestamp"
        data_type: TIMESTAMP_NTZ
        tests:
          - not_null
