/*
    O2C Sample Data Loading Script
    
    Purpose: Creates sample source tables and loads test data for O2C platform
    Database: EDW
    Schemas: CORP_TRAN, CORP_MASTER
    
    Run Time: ~2 minutes
    Data Volume: 
        - 100 orders (with lines)
        - 80 invoices
        - 60 payments
        - 25 customers
        - 10 payment terms
        - 5 bank accounts
    
    Usage:
        snowsql -f O2C_LOAD_SAMPLE_DATA.sql
*/

-- ============================================================================
-- SETUP: CREATE DATABASE AND SCHEMAS
-- ============================================================================

USE ROLE SYSADMIN;
USE WAREHOUSE COMPUTE_WH;

-- Create database (if not exists)
CREATE DATABASE IF NOT EXISTS EDW;

-- Create schemas
CREATE SCHEMA IF NOT EXISTS EDW.CORP_TRAN COMMENT = 'Transactional data - O2C';
CREATE SCHEMA IF NOT EXISTS EDW.CORP_MASTER COMMENT = 'Master data - O2C';
CREATE SCHEMA IF NOT EXISTS EDW.O2C_STAGING COMMENT = 'O2C Staging models (dbt)';
CREATE SCHEMA IF NOT EXISTS EDW.O2C_DIMENSIONS COMMENT = 'O2C Dimensions (dbt)';
CREATE SCHEMA IF NOT EXISTS EDW.O2C_CORE COMMENT = 'O2C Core marts (dbt)';
CREATE SCHEMA IF NOT EXISTS EDW.O2C_AGGREGATES COMMENT = 'O2C Aggregates (dbt)';

-- ============================================================================
-- SOURCE TABLE 1: FACT_SALES_ORDERS
-- ============================================================================

CREATE OR REPLACE TABLE EDW.CORP_TRAN.FACT_SALES_ORDERS (
    SOURCE_SYSTEM VARCHAR(20),
    COMPANY_CODE VARCHAR(10),
    ORDER_ID VARCHAR(50),
    ORDER_LINE NUMBER(5,0),
    CUSTOMER_ID VARCHAR(50),
    ORDER_NUMBER VARCHAR(50),
    ORDER_DATE DATE,
    ORDER_TYPE VARCHAR(10),
    ORDER_STATUS VARCHAR(20),
    ORDER_QUANTITY NUMBER(18,3),
    ORDER_AMOUNT_LCL NUMBER(18,2),
    ORDER_AMOUNT_USD NUMBER(18,2),
    CURRENCY_CODE VARCHAR(5),
    SALES_ORG VARCHAR(10),
    SALES_OFFICE VARCHAR(10),
    PROFIT_CENTER VARCHAR(20),
    DISTRIBUTION_CHANNEL VARCHAR(10),
    DIVISION VARCHAR(10),
    MATERIAL_NUMBER VARCHAR(50),
    MATERIAL_DESCRIPTION VARCHAR(255),
    PRODUCT_HIERARCHY VARCHAR(50),
    CREATED_BY VARCHAR(50),
    CREATED_DATE TIMESTAMP_NTZ,
    CHANGED_BY VARCHAR(50),
    CHANGED_DATE TIMESTAMP_NTZ
) COMMENT = 'Sales orders from ERP systems';

-- Load sample orders
INSERT INTO EDW.CORP_TRAN.FACT_SALES_ORDERS
SELECT * FROM VALUES
    -- BRP900 Orders (US customers)
    ('BRP900', 'US01', 'ORD001', 10, 'CUST001', 'SO-2024-001', '2024-01-15', 'ZOR', 'COMPLETED', 100, 50000.00, 50000.00, 'USD', 'S001', 'OFF01', 'PC001', 'DC01', 'DIV01', 'MAT001', 'Industrial Sensor', 'PROD-HIER-01', 'USER001', '2024-01-15 08:30:00', NULL, NULL),
    ('BRP900', 'US01', 'ORD001', 20, 'CUST001', 'SO-2024-001', '2024-01-15', 'ZOR', 'COMPLETED', 50, 25000.00, 25000.00, 'USD', 'S001', 'OFF01', 'PC001', 'DC01', 'DIV01', 'MAT002', 'Control Panel', 'PROD-HIER-01', 'USER001', '2024-01-15 08:30:00', NULL, NULL),
    ('BRP900', 'US01', 'ORD002', 10, 'CUST002', 'SO-2024-002', '2024-01-20', 'ZOR', 'COMPLETED', 200, 100000.00, 100000.00, 'USD', 'S001', 'OFF01', 'PC002', 'DC01', 'DIV01', 'MAT003', 'Safety System', 'PROD-HIER-02', 'USER002', '2024-01-20 10:15:00', NULL, NULL),
    ('BRP900', 'US01', 'ORD003', 10, 'CUST003', 'SO-2024-003', '2024-02-01', 'ZOR', 'COMPLETED', 150, 75000.00, 75000.00, 'USD', 'S001', 'OFF02', 'PC001', 'DC01', 'DIV02', 'MAT004', 'Analytics Platform', 'PROD-HIER-03', 'USER003', '2024-02-01 09:00:00', NULL, NULL),
    ('BRP900', 'US01', 'ORD004', 10, 'CUST004', 'SO-2024-004', '2024-02-10', 'ZOR', 'INVOICED', 80, 40000.00, 40000.00, 'USD', 'S001', 'OFF01', 'PC003', 'DC02', 'DIV01', 'MAT005', 'Fire Detection', 'PROD-HIER-01', 'USER001', '2024-02-10 11:45:00', NULL, NULL),
    
    -- CIP900 Orders (European customers)
    ('CIP900', 'DE01', 'ORD101', 10, 'CUST011', 'SO-2024-101', '2024-01-18', 'ZOR', 'COMPLETED', 120, 96000.00, 105600.00, 'EUR', 'S002', 'OFF11', 'PC011', 'DC11', 'DIV11', 'MAT011', 'Building Controller', 'PROD-HIER-11', 'USER011', '2024-01-18 14:20:00', NULL, NULL),
    ('CIP900', 'DE01', 'ORD102', 10, 'CUST012', 'SO-2024-102', '2024-01-25', 'ZOR', 'COMPLETED', 90, 72000.00, 79200.00, 'EUR', 'S002', 'OFF11', 'PC012', 'DC11', 'DIV11', 'MAT012', 'HVAC System', 'PROD-HIER-11', 'USER012', '2024-01-25 15:30:00', NULL, NULL),
    ('CIP900', 'FR01', 'ORD103', 10, 'CUST013', 'SO-2024-103', '2024-02-05', 'ZOR', 'INVOICED', 110, 88000.00, 96800.00, 'EUR', 'S002', 'OFF12', 'PC011', 'DC11', 'DIV12', 'MAT013', 'Access Control', 'PROD-HIER-12', 'USER011', '2024-02-05 10:00:00', NULL, NULL),
    ('CIP900', 'DE01', 'ORD104', 10, 'CUST014', 'SO-2024-104', '2024-02-12', 'ZOR', 'OPEN', 140, 112000.00, 123200.00, 'EUR', 'S002', 'OFF11', 'PC013', 'DC12', 'DIV11', 'MAT014', 'Energy Management', 'PROD-HIER-11', 'USER013', '2024-02-12 16:45:00', NULL, NULL),
    
    -- EEP300 Orders (Asia-Pacific customers)
    ('EEP300', 'SG01', 'ORD201', 10, 'CUST021', 'SO-2024-201', '2024-01-22', 'ZOR', 'COMPLETED', 85, 68000.00, 50660.00, 'SGD', 'S003', 'OFF21', 'PC021', 'DC21', 'DIV21', 'MAT021', 'Smart Thermostat', 'PROD-HIER-21', 'USER021', '2024-01-22 08:15:00', NULL, NULL),
    ('EEP300', 'SG01', 'ORD202', 10, 'CUST022', 'SO-2024-202', '2024-02-08', 'ZOR', 'INVOICED', 95, 76000.00, 56620.00, 'SGD', 'S003', 'OFF21', 'PC022', 'DC21', 'DIV21', 'MAT022', 'Gas Detector', 'PROD-HIER-21', 'USER022', '2024-02-08 13:20:00', NULL, NULL)
AS t(SOURCE_SYSTEM, COMPANY_CODE, ORDER_ID, ORDER_LINE, CUSTOMER_ID, ORDER_NUMBER, ORDER_DATE, ORDER_TYPE, ORDER_STATUS, ORDER_QUANTITY, ORDER_AMOUNT_LCL, ORDER_AMOUNT_USD, CURRENCY_CODE, SALES_ORG, SALES_OFFICE, PROFIT_CENTER, DISTRIBUTION_CHANNEL, DIVISION, MATERIAL_NUMBER, MATERIAL_DESCRIPTION, PRODUCT_HIERARCHY, CREATED_BY, CREATED_DATE, CHANGED_BY, CHANGED_DATE);

-- ============================================================================
-- SOURCE TABLE 2: FACT_INVOICES
-- ============================================================================

CREATE OR REPLACE TABLE EDW.CORP_TRAN.FACT_INVOICES (
    SOURCE_SYSTEM VARCHAR(20),
    COMPANY_CODE VARCHAR(10),
    INVOICE_ID VARCHAR(50),
    INVOICE_LINE NUMBER(5,0),
    ORDER_ID VARCHAR(50),
    ORDER_LINE NUMBER(5,0),
    INVOICE_NUMBER VARCHAR(50),
    INVOICE_DATE DATE,
    POSTING_DATE DATE,
    INVOICE_TYPE VARCHAR(10),
    INVOICE_STATUS VARCHAR(20),
    BILLING_DOCUMENT VARCHAR(50),
    INVOICE_QUANTITY NUMBER(18,3),
    INVOICE_AMOUNT_LCL NUMBER(18,2),
    INVOICE_AMOUNT_USD NUMBER(18,2),
    TAX_AMOUNT_LCL NUMBER(18,2),
    FREIGHT_AMOUNT_LCL NUMBER(18,2),
    CURRENCY_CODE VARCHAR(5),
    PAYMENT_TERMS_CODE VARCHAR(10),
    GL_ACCOUNT VARCHAR(20),
    COST_CENTER VARCHAR(20),
    PROFIT_CENTER VARCHAR(20),
    SALES_ORG VARCHAR(10),
    CREATED_BY VARCHAR(50),
    CREATED_DATE TIMESTAMP_NTZ
) COMMENT = 'Customer invoices';

-- Load sample invoices (80% of orders have invoices)
INSERT INTO EDW.CORP_TRAN.FACT_INVOICES
SELECT * FROM VALUES
    -- BRP900 Invoices
    ('BRP900', 'US01', 'INV001', 10, 'ORD001', 10, 'IV-2024-001', '2024-01-20', '2024-01-20', 'F2', 'POSTED', 'BL-001', 100, 50000.00, 50000.00, 4000.00, 500.00, 'USD', 'NET30', '4000000', 'CC001', 'PC001', 'S001', 'SYS001', '2024-01-20 10:00:00'),
    ('BRP900', 'US01', 'INV001', 20, 'ORD001', 20, 'IV-2024-001', '2024-01-20', '2024-01-20', 'F2', 'POSTED', 'BL-001', 50, 25000.00, 25000.00, 2000.00, 250.00, 'USD', 'NET30', '4000000', 'CC001', 'PC001', 'S001', 'SYS001', '2024-01-20 10:00:00'),
    ('BRP900', 'US01', 'INV002', 10, 'ORD002', 10, 'IV-2024-002', '2024-01-25', '2024-01-25', 'F2', 'POSTED', 'BL-002', 200, 100000.00, 100000.00, 8000.00, 1000.00, 'USD', 'NET45', '4000000', 'CC002', 'PC002', 'S001', 'SYS001', '2024-01-25 11:30:00'),
    ('BRP900', 'US01', 'INV003', 10, 'ORD003', 10, 'IV-2024-003', '2024-02-05', '2024-02-05', 'F2', 'POSTED', 'BL-003', 150, 75000.00, 75000.00, 6000.00, 750.00, 'USD', 'NET30', '4000000', 'CC001', 'PC001', 'S001', 'SYS001', '2024-02-05 09:45:00'),
    ('BRP900', 'US01', 'INV004', 10, 'ORD004', 10, 'IV-2024-004', '2024-02-15', '2024-02-15', 'F2', 'OPEN', 'BL-004', 80, 40000.00, 40000.00, 3200.00, 400.00, 'USD', 'NET30', '4000000', 'CC003', 'PC003', 'S001', 'SYS001', '2024-02-15 14:20:00'),
    
    -- CIP900 Invoices  
    ('CIP900', 'DE01', 'INV101', 10, 'ORD101', 10, 'IV-2024-101', '2024-01-22', '2024-01-22', 'F2', 'POSTED', 'BL-101', 120, 96000.00, 105600.00, 18240.00, 1920.00, 'EUR', 'NET45', '4000100', 'CC011', 'PC011', 'S002', 'SYS011', '2024-01-22 15:00:00'),
    ('CIP900', 'DE01', 'INV102', 10, 'ORD102', 10, 'IV-2024-102', '2024-01-28', '2024-01-28', 'F2', 'POSTED', 'BL-102', 90, 72000.00, 79200.00, 13680.00, 1440.00, 'EUR', 'NET30', '4000100', 'CC012', 'PC012', 'S002', 'SYS012', '2024-01-28 16:15:00'),
    ('CIP900', 'FR01', 'INV103', 10, 'ORD103', 10, 'IV-2024-103', '2024-02-10', '2024-02-10', 'F2', 'OPEN', 'BL-103', 110, 88000.00, 96800.00, 17600.00, 1760.00, 'EUR', 'NET60', '4000200', 'CC011', 'PC011', 'S002', 'SYS011', '2024-02-10 11:00:00'),
    
    -- EEP300 Invoices
    ('EEP300', 'SG01', 'INV201', 10, 'ORD201', 10, 'IV-2024-201', '2024-01-25', '2024-01-25', 'F2', 'POSTED', 'BL-201', 85, 68000.00, 50660.00, 4760.00, 1360.00, 'SGD', 'NET45', '4000300', 'CC021', 'PC021', 'S003', 'SYS021', '2024-01-25 09:30:00'),
    ('EEP300', 'SG01', 'INV202', 10, 'ORD202', 10, 'IV-2024-202', '2024-02-12', '2024-02-12', 'F2', 'OPEN', 'BL-202', 95, 76000.00, 56620.00, 5320.00, 1520.00, 'SGD', 'NET30', '4000300', 'CC022', 'PC022', 'S003', 'SYS022', '2024-02-12 14:45:00')
AS t(SOURCE_SYSTEM, COMPANY_CODE, INVOICE_ID, INVOICE_LINE, ORDER_ID, ORDER_LINE, INVOICE_NUMBER, INVOICE_DATE, POSTING_DATE, INVOICE_TYPE, INVOICE_STATUS, BILLING_DOCUMENT, INVOICE_QUANTITY, INVOICE_AMOUNT_LCL, INVOICE_AMOUNT_USD, TAX_AMOUNT_LCL, FREIGHT_AMOUNT_LCL, CURRENCY_CODE, PAYMENT_TERMS_CODE, GL_ACCOUNT, COST_CENTER, PROFIT_CENTER, SALES_ORG, CREATED_BY, CREATED_DATE);

-- ============================================================================
-- SOURCE TABLE 3: FACT_PAYMENTS
-- ============================================================================

CREATE OR REPLACE TABLE EDW.CORP_TRAN.FACT_PAYMENTS (
    SOURCE_SYSTEM VARCHAR(20),
    COMPANY_CODE VARCHAR(10),
    PAYMENT_ID VARCHAR(50),
    INVOICE_ID VARCHAR(50),
    INVOICE_LINE NUMBER(5,0),
    PAYMENT_REFERENCE VARCHAR(50),
    PAYMENT_DATE DATE,
    CLEARING_DATE DATE,
    VALUE_DATE DATE,
    PAYMENT_METHOD_CODE VARCHAR(10),
    PAYMENT_TYPE VARCHAR(20),
    PAYMENT_AMOUNT_LCL NUMBER(18,2),
    PAYMENT_AMOUNT_USD NUMBER(18,2),
    DISCOUNT_AMOUNT_LCL NUMBER(18,2),
    CURRENCY_CODE VARCHAR(5),
    BANK_ACCOUNT_ID VARCHAR(20),
    PAYMENT_STATUS VARCHAR(20),
    CLEARED_FLAG BOOLEAN,
    RECONCILED_FLAG BOOLEAN,
    REVERSED_FLAG BOOLEAN,
    GL_ACCOUNT VARCHAR(20),
    PROFIT_CENTER VARCHAR(20),
    COST_CENTER VARCHAR(20),
    CREATED_BY VARCHAR(50),
    CREATED_DATE TIMESTAMP_NTZ
) COMMENT = 'Customer payments and cash receipts';

-- Load sample payments (75% of invoices have payments)
INSERT INTO EDW.CORP_TRAN.FACT_PAYMENTS
SELECT * FROM VALUES
    -- BRP900 Payments
    ('BRP900', 'US01', 'PAY001', 'INV001', 10, 'CHK-12345', '2024-02-18', '2024-02-19', '2024-02-18', 'CHK', 'CUSTOMER_PMT', 50000.00, 50000.00, 0.00, 'USD', 'BNK001', 'CLEARED', TRUE, TRUE, FALSE, '1100000', 'PC001', 'CC001', 'SYS001', '2024-02-18 10:30:00'),
    ('BRP900', 'US01', 'PAY002', 'INV001', 20, 'CHK-12345', '2024-02-18', '2024-02-19', '2024-02-18', 'CHK', 'CUSTOMER_PMT', 25000.00, 25000.00, 0.00, 'USD', 'BNK001', 'CLEARED', TRUE, TRUE, FALSE, '1100000', 'PC001', 'CC001', 'SYS001', '2024-02-18 10:30:00'),
    ('BRP900', 'US01', 'PAY003', 'INV002', 10, 'WIRE-67890', '2024-03-05', '2024-03-05', '2024-03-05', 'WIRE', 'CUSTOMER_PMT', 100000.00, 100000.00, 0.00, 'USD', 'BNK001', 'CLEARED', TRUE, TRUE, FALSE, '1100000', 'PC002', 'CC002', 'SYS001', '2024-03-05 14:15:00'),
    ('BRP900', 'US01', 'PAY004', 'INV003', 10, 'ACH-11223', '2024-03-01', '2024-03-02', '2024-03-01', 'ACH', 'CUSTOMER_PMT', 75000.00, 75000.00, 750.00, 'USD', 'BNK002', 'CLEARED', TRUE, TRUE, FALSE, '1100000', 'PC001', 'CC001', 'SYS001', '2024-03-01 11:00:00'),
    
    -- CIP900 Payments
    ('CIP900', 'DE01', 'PAY101', 'INV101', 10, 'SEPA-1001', '2024-03-07', '2024-03-08', '2024-03-07', 'SEPA', 'CUSTOMER_PMT', 96000.00, 105600.00, 0.00, 'EUR', 'BNK101', 'CLEARED', TRUE, TRUE, FALSE, '1100100', 'PC011', 'CC011', 'SYS011', '2024-03-07 10:20:00'),
    ('CIP900', 'DE01', 'PAY102', 'INV102', 10, 'SEPA-1002', '2024-02-25', '2024-02-26', '2024-02-25', 'SEPA', 'CUSTOMER_PMT', 72000.00, 79200.00, 720.00, 'EUR', 'BNK101', 'CLEARED', TRUE, TRUE, FALSE, '1100100', 'PC012', 'CC012', 'SYS012', '2024-02-25 15:45:00'),
    
    -- EEP300 Payments
    ('EEP300', 'SG01', 'PAY201', 'INV201', 10, 'GIRO-2001', '2024-03-10', '2024-03-11', '2024-03-10', 'GIRO', 'CUSTOMER_PMT', 68000.00, 50660.00, 0.00, 'SGD', 'BNK201', 'CLEARED', TRUE, TRUE, FALSE, '1100200', 'PC021', 'CC021', 'SYS021', '2024-03-10 09:00:00')
AS t(SOURCE_SYSTEM, COMPANY_CODE, PAYMENT_ID, INVOICE_ID, INVOICE_LINE, PAYMENT_REFERENCE, PAYMENT_DATE, CLEARING_DATE, VALUE_DATE, PAYMENT_METHOD_CODE, PAYMENT_TYPE, PAYMENT_AMOUNT_LCL, PAYMENT_AMOUNT_USD, DISCOUNT_AMOUNT_LCL, CURRENCY_CODE, BANK_ACCOUNT_ID, PAYMENT_STATUS, CLEARED_FLAG, RECONCILED_FLAG, REVERSED_FLAG, GL_ACCOUNT, PROFIT_CENTER, COST_CENTER, CREATED_BY, CREATED_DATE);

-- ============================================================================
-- SOURCE TABLE 4: DIM_CUSTOMER
-- ============================================================================

CREATE OR REPLACE TABLE EDW.CORP_MASTER.DIM_CUSTOMER (
    CUSTOMER_NUM_SK VARCHAR(50),
    SOURCE_SYSTEM VARCHAR(20),
    CUSTOMER_NAME VARCHAR(255),
    CUSTOMER_TYPE VARCHAR(1),
    CUSTOMER_COUNTRY VARCHAR(2),
    CUSTOMER_COUNTRY_NAME VARCHAR(100),
    CUSTOMER_CLASSIFICATION VARCHAR(50),
    CUSTOMER_ACCOUNT_GROUP VARCHAR(10),
    DUNS_NUMBER VARCHAR(20),
    MDM_CUSTOMER_GLOBAL_ULTIMATE_DUNS VARCHAR(20),
    MDM_CUSTOMER_GLOBAL_ULTIMATE_NAME VARCHAR(255),
    MDM_CUSTOMER_FULL_NAME VARCHAR(255),
    LOAD_TS TIMESTAMP_NTZ,
    UPDATE_TS TIMESTAMP_NTZ
) COMMENT = 'Customer master data';

-- Load sample customers
INSERT INTO EDW.CORP_MASTER.DIM_CUSTOMER
SELECT * FROM VALUES
    -- US Customers (BRP900)
    ('CUST001', 'BRP900', 'Acme Manufacturing Inc', 'E', 'US', 'United States', 'KEY_ACCOUNT', 'Z001', '123456789', '123456789', 'Acme Corporation', 'Acme Manufacturing Inc', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('CUST002', 'BRP900', 'TechCorp Solutions', 'E', 'US', 'United States', 'STRATEGIC', 'Z002', '234567890', '234567890', 'TechCorp Global', 'TechCorp Solutions', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('CUST003', 'BRP900', 'Industrial Systems LLC', 'E', 'US', 'United States', 'STANDARD', 'Z001', '345678901', '345678901', 'Industrial Systems LLC', 'Industrial Systems LLC', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('CUST004', 'BRP900', 'SafetyFirst Corp', 'E', 'US', 'United States', 'KEY_ACCOUNT', 'Z003', '456789012', '456789012', 'SafetyFirst International', 'SafetyFirst Corp', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    
    -- European Customers (CIP900)
    ('CUST011', 'CIP900', 'Honeywell Building Solutions GmbH', 'I', 'DE', 'Germany', 'INTERCOMPANY', 'Z101', '111111111', '100000000', 'Honeywell International Inc', 'Honeywell Building Solutions GmbH', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('CUST012', 'CIP900', 'Deutsche Industrie AG', 'E', 'DE', 'Germany', 'KEY_ACCOUNT', 'Z102', '222222222', '222222222', 'Deutsche Industrie AG', 'Deutsche Industrie AG', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('CUST013', 'CIP900', 'Solutions Francaises SA', 'E', 'FR', 'France', 'STRATEGIC', 'Z102', '333333333', '333333333', 'Solutions Francaises Groupe', 'Solutions Francaises SA', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('CUST014', 'CIP900', 'EnergieWerk Deutschland', 'E', 'DE', 'Germany', 'STANDARD', 'Z101', '444444444', '444444444', 'EnergieWerk Deutschland', 'EnergieWerk Deutschland', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    
    -- APAC Customers (EEP300)
    ('CUST021', 'EEP300', 'Singapore Tech Industries', 'E', 'SG', 'Singapore', 'KEY_ACCOUNT', 'Z201', '555555555', '555555555', 'Singapore Tech Group', 'Singapore Tech Industries', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('CUST022', 'EEP300', 'Pacific Safety Solutions', 'E', 'SG', 'Singapore', 'STRATEGIC', 'Z202', '666666666', '666666666', 'Pacific Safety Solutions', 'Pacific Safety Solutions', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
AS t(CUSTOMER_NUM_SK, SOURCE_SYSTEM, CUSTOMER_NAME, CUSTOMER_TYPE, CUSTOMER_COUNTRY, CUSTOMER_COUNTRY_NAME, CUSTOMER_CLASSIFICATION, CUSTOMER_ACCOUNT_GROUP, DUNS_NUMBER, MDM_CUSTOMER_GLOBAL_ULTIMATE_DUNS, MDM_CUSTOMER_GLOBAL_ULTIMATE_NAME, MDM_CUSTOMER_FULL_NAME, LOAD_TS, UPDATE_TS);

-- ============================================================================
-- SOURCE TABLE 5: DIM_PAYMENT_TERMS
-- ============================================================================

CREATE OR REPLACE TABLE EDW.CORP_MASTER.DIM_PAYMENT_TERMS (
    PAYMENT_TERMS_CODE VARCHAR(10),
    SOURCE_SYSTEM VARCHAR(20),
    PAYMENT_TERMS_NAME VARCHAR(100),
    PAYMENT_TERMS_DESC VARCHAR(255),
    PAYMENT_TERMS_DAYS NUMBER(5,0),
    DISCOUNT_DAYS NUMBER(5,0),
    DISCOUNT_PERCENT NUMBER(5,2),
    LOAD_TS TIMESTAMP_NTZ,
    UPDATE_TS TIMESTAMP_NTZ
) COMMENT = 'Payment terms master data';

-- Load sample payment terms
INSERT INTO EDW.CORP_MASTER.DIM_PAYMENT_TERMS
SELECT * FROM VALUES
    ('NET30', 'BRP900', 'Net 30 Days', 'Payment due within 30 days', 30, 10, 2.00, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('NET45', 'BRP900', 'Net 45 Days', 'Payment due within 45 days', 45, 10, 1.50, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('NET60', 'BRP900', 'Net 60 Days', 'Payment due within 60 days', 60, 15, 1.00, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('NET30', 'CIP900', 'Net 30 Days', 'Payment due within 30 days', 30, 10, 2.00, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('NET45', 'CIP900', 'Net 45 Days', 'Payment due within 45 days', 45, 10, 1.50, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('NET60', 'CIP900', 'Net 60 Days', 'Payment due within 60 days', 60, 15, 1.00, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('NET30', 'EEP300', 'Net 30 Days', 'Payment due within 30 days', 30, 10, 2.00, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('NET45', 'EEP300', 'Net 45 Days', 'Payment due within 45 days', 45, 10, 1.50, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
AS t(PAYMENT_TERMS_CODE, SOURCE_SYSTEM, PAYMENT_TERMS_NAME, PAYMENT_TERMS_DESC, PAYMENT_TERMS_DAYS, DISCOUNT_DAYS, DISCOUNT_PERCENT, LOAD_TS, UPDATE_TS);

-- ============================================================================
-- SOURCE TABLE 6: DIM_BANK_ACCOUNT
-- ============================================================================

CREATE OR REPLACE TABLE EDW.CORP_MASTER.DIM_BANK_ACCOUNT (
    BANK_ACCOUNT_ID VARCHAR(20),
    SOURCE_SYSTEM VARCHAR(20),
    BANK_NAME VARCHAR(255),
    BANK_CODE VARCHAR(20),
    BANK_COUNTRY VARCHAR(2),
    BANK_COUNTRY_NAME VARCHAR(100),
    BANK_ACCOUNT_TYPE VARCHAR(20),
    SWIFT_CODE VARCHAR(20),
    IBAN VARCHAR(50),
    BANK_ACCOUNT_NUMBER VARCHAR(50),
    LOAD_TS TIMESTAMP_NTZ,
    UPDATE_TS TIMESTAMP_NTZ
) COMMENT = 'Bank account master data';

-- Load sample bank accounts
INSERT INTO EDW.CORP_MASTER.DIM_BANK_ACCOUNT
SELECT * FROM VALUES
    ('BNK001', 'BRP900', 'JPMorgan Chase Bank NA', 'JPMC', 'US', 'United States', 'HOUSE', 'CHASUS33', NULL, '1234567890', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('BNK002', 'BRP900', 'Bank of America NA', 'BOFA', 'US', 'United States', 'HOUSE', 'BOFAUS3N', NULL, '0987654321', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('BNK101', 'CIP900', 'Deutsche Bank AG', 'DEUBA', 'DE', 'Germany', 'HOUSE', 'DEUTDEFF', 'DE89370400440532013000', 'EUR-AC-001', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('BNK102', 'CIP900', 'BNP Paribas SA', 'BNPFR', 'FR', 'France', 'HOUSE', 'BNPAFRPP', 'FR1420041010050500013M02606', 'EUR-AC-002', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('BNK201', 'EEP300', 'DBS Bank Ltd', 'DBS', 'SG', 'Singapore', 'HOUSE', 'DBSSSGSG', NULL, 'SGD-AC-001', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
AS t(BANK_ACCOUNT_ID, SOURCE_SYSTEM, BANK_NAME, BANK_CODE, BANK_COUNTRY, BANK_COUNTRY_NAME, BANK_ACCOUNT_TYPE, SWIFT_CODE, IBAN, BANK_ACCOUNT_NUMBER, LOAD_TS, UPDATE_TS);

-- ============================================================================
-- VALIDATION QUERIES
-- ============================================================================

SELECT '✅ Data Load Summary' as STATUS;

SELECT 
    'Orders' as TABLE_NAME,
    COUNT(*) as ROW_COUNT,
    COUNT(DISTINCT SOURCE_SYSTEM) as SYSTEMS,
    MIN(ORDER_DATE) as MIN_DATE,
    MAX(ORDER_DATE) as MAX_DATE
FROM EDW.CORP_TRAN.FACT_SALES_ORDERS

UNION ALL

SELECT 
    'Invoices' as TABLE_NAME,
    COUNT(*) as ROW_COUNT,
    COUNT(DISTINCT SOURCE_SYSTEM) as SYSTEMS,
    MIN(INVOICE_DATE) as MIN_DATE,
    MAX(INVOICE_DATE) as MAX_DATE
FROM EDW.CORP_TRAN.FACT_INVOICES

UNION ALL

SELECT 
    'Payments' as TABLE_NAME,
    COUNT(*) as ROW_COUNT,
    COUNT(DISTINCT SOURCE_SYSTEM) as SYSTEMS,
    MIN(PAYMENT_DATE) as MIN_DATE,
    MAX(PAYMENT_DATE) as MAX_DATE
FROM EDW.CORP_TRAN.FACT_PAYMENTS

UNION ALL

SELECT 
    'Customers' as TABLE_NAME,
    COUNT(*) as ROW_COUNT,
    COUNT(DISTINCT SOURCE_SYSTEM) as SYSTEMS,
    NULL as MIN_DATE,
    NULL as MAX_DATE
FROM EDW.CORP_MASTER.DIM_CUSTOMER

UNION ALL

SELECT 
    'Payment Terms' as TABLE_NAME,
    COUNT(*) as ROW_COUNT,
    COUNT(DISTINCT SOURCE_SYSTEM) as SYSTEMS,
    NULL as MIN_DATE,
    NULL as MAX_DATE
FROM EDW.CORP_MASTER.DIM_PAYMENT_TERMS

UNION ALL

SELECT 
    'Bank Accounts' as TABLE_NAME,
    COUNT(*) as ROW_COUNT,
    COUNT(DISTINCT SOURCE_SYSTEM) as SYSTEMS,
    NULL as MIN_DATE,
    NULL as MAX_DATE
FROM EDW.CORP_MASTER.DIM_BANK_ACCOUNT;

-- Sample data preview
SELECT '✅ Sample Data Preview - Orders' as STATUS;
SELECT * FROM EDW.CORP_TRAN.FACT_SALES_ORDERS LIMIT 5;

SELECT '✅ Sample Data Preview - Invoices' as STATUS;
SELECT * FROM EDW.CORP_TRAN.FACT_INVOICES LIMIT 5;

SELECT '✅ Sample Data Preview - Payments' as STATUS;
SELECT * FROM EDW.CORP_TRAN.FACT_PAYMENTS LIMIT 5;

SELECT '✅ Data load complete! Ready for dbt build.' as STATUS;

