version: 2

metrics:
  # ═══════════════════════════════════════════════════
  # VOLUME METRICS
  # ═══════════════════════════════════════════════════
  
  - name: mtc_order_count
    label: "Order Count"
    description: "Total number of orders"
    type: simple
    type_params:
      measure: order_count
  
  - name: mtc_invoice_count
    label: "Invoice Count"
    description: "Total number of invoices"
    type: simple
    type_params:
      measure:
        name: order_count
        filter: "invoice_key != 'NOT_INVOICED'"
  
  - name: mtc_payment_count
    label: "Payment Count"
    description: "Total number of payments"
    type: simple
    type_params:
      measure:
        name: order_count
        filter: "payment_key != 'NOT_PAID'"
  
  # ═══════════════════════════════════════════════════
  # AMOUNT METRICS
  # ═══════════════════════════════════════════════════
  
  - name: mtc_total_order_value
    label: "Total Order Value"
    description: "Sum of all order amounts"
    type: simple
    type_params:
      measure: total_order_amount
  
  - name: mtc_total_outstanding
    label: "Total AR Outstanding"
    description: "Sum of all outstanding amounts"
    type: simple
    type_params:
      measure: total_outstanding_amount
  
  # ═══════════════════════════════════════════════════
  # PERFORMANCE METRICS
  # ═══════════════════════════════════════════════════
  
  - name: mtc_days_sales_outstanding
    label: "Days Sales Outstanding (DSO)"
    description: "Average days from order to cash"
    type: simple
    type_params:
      measure: avg_days_to_cash
  
  - name: mtc_days_to_invoice
    label: "Average Days to Invoice"
    description: "Average days from order to invoice"
    type: derived
    type_params:
      expr: "avg(days_order_to_invoice)"
      metrics:
        - name: order_count
  
  - name: mtc_days_to_payment
    label: "Average Days to Payment"
    description: "Average days from invoice to payment"
    type: derived
    type_params:
      expr: "avg(days_invoice_to_payment)"
      metrics:
        - name: order_count
  
  # ═══════════════════════════════════════════════════
  # RATIO METRICS
  # ═══════════════════════════════════════════════════
  
  - name: mtc_billing_rate
    label: "Billing Rate %"
    description: "Percentage of orders that have been invoiced"
    type: ratio
    type_params:
      numerator: mtc_invoice_count
      denominator: mtc_order_count
  
  - name: mtc_collection_rate
    label: "Collection Rate %"
    description: "Percentage of invoices that have been paid"
    type: ratio
    type_params:
      numerator: mtc_payment_count
      denominator: mtc_invoice_count
  
  - name: mtc_on_time_payment_rate
    label: "On-Time Payment Rate %"
    description: "Percentage of payments made on time"
    type: ratio
    type_params:
      numerator:
        name: mtc_payment_count
        filter: "payment_timing = 'ON_TIME'"
      denominator: mtc_payment_count
  
  # ═══════════════════════════════════════════════════
  # CUSTOMER METRICS
  # ═══════════════════════════════════════════════════
  
  - name: mtc_avg_order_value_per_customer
    label: "Average Order Value per Customer"
    description: "Average order value by customer"
    type: derived
    type_params:
      expr: "mtc_total_order_value / mtc_order_count"
      metrics:
        - mtc_total_order_value
        - mtc_order_count

